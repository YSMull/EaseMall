webpackJsonp([1],{148:function(t,i,e){"use strict";function o(t){a||e(369)}Object.defineProperty(i,"__esModule",{value:!0});var r=e(267),s=e(370),a=!1,n=e(4),l=o,c=n(r.a,s.a,!1,l,"data-v-05f32c65",null);c.options.__file="src/views/publish.vue",i.default=c.exports},196:function(t,i,e){"use strict";i.a={props:{picUrl:String},data:function(){return{top:0,left:0,dd:!1}},methods:{handOut:function(t){this.dd=!1},handOver:function(t){this.dd=!0},handMove:function(t){this.imgObj=this.$refs.innerImg,this.imgRect=this.imgObj.getBoundingClientRect();var i=t.x-this.imgRect.left,e=t.y-this.imgRect.top;i<100&&(this.left=0),i>300&&(this.left=200),e<100&&(this.top=0),e>300&&(this.top=200),i>=100&&i<=300&&(this.left=i-100>=0?i-100:0),e>=100&&e<=300&&(this.top=e-100>=0?e-100:0)}},mounted:function(){var t=this;this.$refs.innerImg.onload=function(){t.$emit("on-pic-loaded")},this.$refs.innerImg.onerror=function(){t.$emit("on-pic-error")}}}},212:function(t,i,e){"use strict";function o(t){a||e(213)}var r=e(196),s=e(214),a=!1,n=e(4),l=o,c=n(r.a,s.a,!1,l,"data-v-546d2210",null);c.options.__file="src/common/e-img.vue",i.a=c.exports},213:function(t,i){},214:function(t,i,e){"use strict";var o=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"e-img-container",on:{mouseover:t.handOver,mousemove:t.handMove,mouseout:t.handOut}},[e("img",{ref:"innerImg",staticClass:"e-img",attrs:{src:t.picUrl}}),t._v(" "),e("b",{staticClass:"shadow",style:{top:t.top+"px",left:t.left+"px",display:t.dd?"block":"none"}})]),t._v(" "),e("div",{staticClass:"showDetails",style:{display:t.dd?"block":"none"}},[e("img",{staticClass:"showImgBig",style:{top:-2*t.top+"px",left:-2*t.left+"px"},attrs:{src:t.picUrl}})])])},r=[];o._withStripped=!0;var s={render:o,staticRenderFns:r};i.a=s},267:function(t,i,e){"use strict";var o=e(2),r=e(212);i.a={components:{EImage:r.a},data:function(){return{id:this.$route.params.goodsId,picLoadError:!1,picLoadSuccess:!1,loadingPic:!1,uploadType:"file",maxPicSize:1024,formPublish:{name:"",description:"",detail:"",price:0,picture:null,picUrl:""},ruleValidate:{name:[{required:!0,message:"请输入商品名",trigger:"blur"},{type:"string",min:2,max:80,message:"商品名的长度在2～80个字符",trigger:"blur"}],description:[{required:!0,message:"请输入商品摘要",trigger:"blur"},{type:"string",min:2,max:140,message:"商品摘要应在2～140个字符",trigger:"blur"}],picture:[{required:!0,validator:function(t,i,e){null===i?e([new Error("请上传照片")]):i.size>1024e3?e([new Error("照片大小为"+i.size/1e6+"MB, 超过1MB")]):e()},trigger:"blur"}],detail:[{required:!0,message:"请输入商品详情",trigger:"blur"},{type:"string",min:2,max:1e3,message:"商品正文应在2～1000个字符",trigger:"blur"}],price:[{required:!0,type:"number",min:.01,message:"请输入正确的商品价格",trigger:"blur"}]}}},methods:{editPicUrl:function(){this.formPublish.picture=null,this.picLoadSuccess=!1,this.picLoadError=!1,this.loadingPic=!1},validateUrl:function(){this.loadingPic=!0},picLoaded:function(){this.picLoadSuccess=!0,this.picLoadError=!1,this.setPic()},picError:function(){this.picLoadSuccess=!1,this.picLoadError=!0},setPic:function(){var t=this;this.$http.get("/pic/proxy?picUrl="+this.formPublish.picUrl,{responseType:"blob"}).then(function(i){var e=i.data;t.formPublish.picture=e,console.log(e)})},handleUpload:function(t){return this.formPublish.picture=t,!1},getFormData:function(){var t=this.formPublish.picture,i=new FormData;return void 0!=this.$route.params.goodsId&&i.append("id",this.$route.params.goodsId),i.append("name",this.formPublish.name),i.append("description",this.formPublish.description),i.append("detail",this.formPublish.detail),i.append("price",this.formPublish.price),i.append("file",t),i},handlePublish:function(){var t=this;this.$refs.formPublish.validate(function(i){i&&t.$Modal.confirm({title:"确认发布商品？",content:"",onOk:function(){t.$http.post("/publish/new",t.getFormData(),{headers:{"Content-Type":"multipart/form-data"}}).then(function(i){t.$router.push({name:"goods",params:{goodsId:i.data.data.id}})})},onCancel:function(){}})})},handleSave:function(){var t=this;this.$refs.formPublish.validate(function(i){i&&t.$Modal.confirm({title:"确认修改商品信息？",content:"",onOk:function(){t.$http.post("/publish/save",t.getFormData()).then(function(i){t.$router.push({name:"goods",params:{goodsId:t.$route.params.goodsId}})})},onCancel:function(){}})})},changeUploadType:function(t){"url"===t?this.formPublish.picture=null:"file"===t&&(this.formPublish.picUrl="")},initData:function(){this.formPublish.name="",this.formPublish.description="",this.formPublish.price=0,this.formPublish.detail="",this.formPublish.picUrl="",this.uploadType="file",this.loadingPic=!1},fetchData:function(){var t=this;void 0!=this.$route.params.goodsId?this.$http.get("/goods/"+this.$route.params.goodsId).then(function(i){var e=i.data.data;t.formPublish.name=e.name,t.formPublish.description=e.description,t.formPublish.price=e.price,t.formPublish.detail=e.detail,t.formPublish.picUrl=(e.picUrl.startsWith("http")?"":location.protocol+"//"+location.host)+e.picUrl,t.uploadType="url",t.loadingPic=!0}):this.initData()}},watch:{$route:"fetchData"},beforeRouteEnter:function(t,i,e){o.default.prototype.$validate(t,i,e)},mounted:function(){console.log("publish mounted"),this.fetchData()}}},369:function(t,i){},370:function(t,i,e){"use strict";var o=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"e-publish"},[e("Form",{ref:"formPublish",attrs:{model:t.formPublish,rules:t.ruleValidate,"label-width":80}},[e("FormItem",{attrs:{label:"标题",prop:"name"}},[e("Input",{attrs:{placeholder:"请输入商品名称..."},model:{value:t.formPublish.name,callback:function(i){t.$set(t.formPublish,"name",i)},expression:"formPublish.name"}})],1),t._v(" "),e("FormItem",{attrs:{label:"摘要",prop:"description"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"请输入商品摘要..."},model:{value:t.formPublish.description,callback:function(i){t.$set(t.formPublish,"description",i)},expression:"formPublish.description"}})],1),t._v(" "),e("FormItem",{attrs:{label:"商品图片",prop:"picture"}},[e("RadioGroup",{on:{"on-change":t.changeUploadType},model:{value:t.uploadType,callback:function(i){t.uploadType=i},expression:"uploadType"}},[e("Radio",{attrs:{label:"file"}},[t._v("文件")]),t._v(" "),e("Radio",{attrs:{label:"url"}},[t._v("链接")])],1),t._v(" "),e("Upload",{directives:[{name:"show",rawName:"v-show",value:"file"===this.uploadType,expression:"this.uploadType === 'file'"}],ref:"upload",attrs:{"before-upload":t.handleUpload,accept:"image/*",action:"/api/goods_pic"},model:{value:t.formPublish.picture,callback:function(i){t.$set(t.formPublish,"picture",i)},expression:"formPublish.picture"}},["file"===this.uploadType?e("Button",{attrs:{type:"ghost",icon:"ios-cloud-upload-outline"}},[t._v("上传图片")]):t._e()],1),t._v(" "),"file"===this.uploadType?e("FormItem",[e("div",[null!==t.formPublish.picture?e("div",[t._v("\n                            待上传: "+t._s(t.formPublish.picture.name)+" \n                        ")]):t._e()])]):t._e(),t._v(" "),"url"===this.uploadType?e("FormItem",[e("div",[e("Row",[e("Col",{attrs:{span:"18"}},[e("Input",{attrs:{label:"图片链接"},on:{"on-change":t.editPicUrl},model:{value:t.formPublish.picUrl,callback:function(i){t.$set(t.formPublish,"picUrl",i)},expression:"formPublish.picUrl"}})],1),t._v(" "),e("Col",{staticStyle:{"margin-left":"12px"},attrs:{span:"4"}},[t.picLoadSuccess||t.picLoadError?t._e():e("Button",{attrs:{type:"primary",loading:t.loadingPic&&!t.picLoadSuccess&&!t.picLoadError},on:{click:function(i){i.preventDefault(),t.validateUrl(i)}}},[t._v("校验图片")]),t._v(" "),t.picLoadError?e("Button",{attrs:{type:"warning"},on:{click:function(i){i.preventDefault(),t.editPicUrl(i)}}},[t._v("图片加载失败")]):t._e(),t._v(" "),t.picLoadSuccess?e("Button",{attrs:{type:"success"},on:{click:function(i){i.preventDefault(),t.editPicUrl(i)}}},[t._v("图片加载成功")]):t._e()],1)],1),t._v(" "),t.loadingPic?e("Row",[e("EImage",{ref:"eimg",attrs:{picUrl:"/api/pic/proxy?picUrl="+t.formPublish.picUrl},on:{"on-pic-loaded":t.picLoaded,"on-pic-error":t.picError}})],1):t._e()],1)]):t._e()],1),t._v(" "),e("FormItem",{attrs:{label:"正文",prop:"detail"}},[e("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入商品详情..."},model:{value:t.formPublish.detail,callback:function(i){t.$set(t.formPublish,"detail",i)},expression:"formPublish.detail"}})],1),t._v(" "),e("FormItem",{attrs:{label:"价格",prop:"price"}},[e("Input",{attrs:{number:"",placeholder:"请输入商品定价..."},model:{value:t.formPublish.price,callback:function(i){t.$set(t.formPublish,"price",i)},expression:"formPublish.price"}})],1),t._v(" "),e("FormItem",[void 0!=this.$route.params.goodsId?e("Button",{on:{click:t.handleSave}},[t._v("保存")]):e("Button",{on:{click:t.handlePublish}},[t._v("发布")])],1)],1)],1)])},r=[];o._withStripped=!0;var s={render:o,staticRenderFns:r};i.a=s}});